<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>ePark</title>
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
	integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
	crossorigin="anonymous">

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
	integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
	crossorigin="anonymous"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
	integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
	crossorigin="anonymous"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
	integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
	crossorigin="anonymous"></script>

<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

<style>
body {
	padding-top: 56px;
}
</style>

</head>
<body>

	<!--  Navigation Bar -->

	<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
		<a class="navbar-brand" href="">ePark</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse"
			data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown"
			aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarNavDropdown">
			<ul class="navbar-nav">
				<li class="nav-item active"><a class="nav-link" href="/home">Home
						<span class="sr-only">(current)</span>
				</a></li>
				<div sec:authorize="isAnonymous()">
					<li class="nav-item dropdown"><a
						class="nav-link dropdown-toggle" href="#"
						id="navbarDropdownMenuLink" data-toggle="dropdown"
						aria-haspopup="true" aria-expanded="false"> My Account </a>
						<div class="dropdown-menu"
							aria-labelledby="navbarDropdownMenuLink">
							<a class="dropdown-item" href="/login">Log in</a> <a
								class="dropdown-item" href="/registration">Register</a>
						</div></li>
				</div>


				<li class="nav-item dropdown" sec:authorize="isAuthenticated()"><a
					class="nav-link dropdown-toggle" href="#"
					id="navbarDropdownMenuLink" data-toggle="dropdown"
					aria-haspopup="true" aria-expanded="false"> My Account </a>
					<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
						<a sec:authorize="hasAnyAuthority('USER')" class="dropdown-item"
							href="#">View reservations</a> <a class="dropdown-item" href="#">View
							account details</a> <a class="dropdown-item" href="/logout">Log
							out</a>
					</div></li>

				<li class="nav-item dropdown"
					sec:authorize="isAuthenticated()&&hasAnyAuthority('ADMIN','CARPARKOWNER')"><a
					class="nav-link dropdown-toggle" href="#"
					id="navbarDropdownMenuLink" data-toggle="dropdown"
					aria-haspopup="true" aria-expanded="false"> Manage car parks </a>
					<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
						<a class="dropdown-item" href="/viewcarparkforuser">View car
							parks</a> <a class="dropdown-item" href="/addcarpark">Add car
							parks</a>
					</div></li>
				<li class="nav-item dropdown"
					sec:authorize="isAuthenticated()&&hasAnyAuthority('ADMIN')"><a
					class="nav-link dropdown-toggle" href="#"
					id="navbarDropdownMenuLink" data-toggle="dropdown"
					aria-haspopup="true" aria-expanded="false"> Admin Menu </a>
					<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
						<a class="dropdown-item" href="/viewcarpark">View car park
							submissions</a> <a class="dropdown-item" href="">View
							reservations</a>
					</div></li>

			</ul>

		</div>
	</nav>



	<br>
	<br>
	<br>

	<h1 style="margin: auto; width: 90%;">View car parks</h1>

	<br>
	<div th:if="${param.success}">
		<div class="alert alert-success alert-dismissible fade show"
			style="margin-top: auto; margin-right: auto; margin-left: auto; margin-bottom: 10px; width: 90%;" role="alert">
			Action submitted successfully
			<button type="button" class="close" data-dismiss="alert"
				aria-label="Close">
				<span aria-hidden="true">&times;</span> 
			</button>
			
		</div>
		
	</div>
		<div th:if="${param.comment}">
		<div class="alert alert-info alert-dismissible fade show"
			style="margin-top: auto; margin-right: auto; margin-left: auto; margin-bottom: 10px; width: 90%;" role="alert">
			Comment added
			<button type="button" class="close" data-dismiss="alert"
				aria-label="Close">
				<span aria-hidden="true">&times;</span> 
			</button>
			
		</div>
		
	</div>


	<div class="card" style="margin: auto; width: 90%;">
		<table class="table table-striped table-hover table-responsive-xl">
			<thead>
				<tr style="text-align: center; vertical-align: top">
					<th>Name</th>
					<th>Address</th>
					<th>Email</th>
					<th>Parking Rate</th>
					<th>Date Modified</th>
					<th>Price</th>
					<th>Status</th>
					<th>Comments</th>
					<th>Details</th>
					<th sec:authorize="isAuthenticated()&&hasAnyAuthority('ADMIN')">Action</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="carpark : ${carparklist}"
					style="text-align: center; vertical-align: top">
					<td th:text="${carpark.name}"></td>
					<td
						th:text="${carpark.carParkAddress1}+', '+${carpark.carParkAddress2}+', '+${carpark.carParkCity}+', '+${carpark.carParkPostcode}"></td>
					<td th:text="${carpark.email}"></td>
					<td th:text="${carpark.parkingRate}"></td>
					<td
						th:text="${#dates.format(carpark.dateModified, 'dd/MM/yy HH:mm')}"></td>
					<td th:text="'Â£'+ ${carpark.price}"></td>
					<td><b th:text="${carpark.carParkStatus}"></b></td>
					<td><a id="details"
						th:attr="data-target='#viewcomments'+${carpark}"
						data-toggle="modal" href="">Comments</a></td>
					<td><a id="details"
						th:attr="data-target='#viewdetails'+${carpark}"
						data-toggle="modal" href="">Details</a></td>
					<td sec:authorize="isAuthenticated()&&hasAnyAuthority('ADMIN')">

						<div id="buttons"
							th:if="${carpark.carParkStatus.toString()} == 'SUBMITTED'"> 
							<button class="btn btn-primary btn-sm" data-toggle="modal"
								th:attr="data-target='#approve'+${carpark.carParkId}"
								>Approve</button> <button class="btn btn-secondary btn-sm"
								th:attr="data-target='#reject'+${carpark.carParkId}"
								data-toggle="modal" >Reject</button>

 						</div> 


						<div class="modal fade" style="text-align: left"
							th:attr="id='approve'+${carpark.carParkId}" role="dialog"
							aria-labelledby="exampleModalLabel" aria-hidden="true">
							<div class="modal-dialog" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title" id="exampleModalLabel"
											th:text="${carpark.name}"></h5>
										<button type="button" class="close" data-dismiss="modal"
											aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<form
										th:action="'/viewcarpark/approve/' + ${carpark.carParkId}"
										method="post" th:object="${carParkDto}">
										<div class="modal-body">
											<label for="message-text" class="col-form-label"
												style="text-align: left">You are about to approve
												this car park</label>

										</div>
										<div class="modal-footer">
											<button type="button" class="btn btn-secondary"
												data-dismiss="modal">Close</button>
											<button class="btn btn-primary" type="submit">Approve</button>
										</div>
									</form>
								</div>
							</div>
						</div>

						<div class="modal fade" th:attr="id='reject'+${carpark.carParkId}"
							style="text-align: left" role="dialog"
							aria-labelledby="exampleModalLabel" aria-hidden="true">
							<div class="modal-dialog" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title" id="exampleModalLabel"
											th:text="${carpark.name}"></h5>
										<button type="button" class="close" data-dismiss="modal"
											aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<form th:action="'/viewcarpark/reject/' + ${carpark.carParkId}"
										method="post" th:object="${carParkDto}">
										<div class="modal-body">


											<label for="message-text" class="col-form-label"
												style="text-align: left">You are about to reject
												this car park</label>


										</div>
										<div class="modal-footer">
											<button type="button" class="btn btn-secondary"
												data-dismiss="modal">Close</button>
											<button class="btn btn-danger" type="submit">Reject</button>
										</div>
									</form>
								</div>
							</div>
						</div>

						<div class="modal" role="dialog"
							th:attr="id='viewdetails'+ ${carpark}">
							<div class="modal-dialog" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title">View car park details</h5>
										<button type="button" class="close" data-dismiss="modal"
											aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<div class="modal-body">
										<div class="card">
											<table class="table table-striped table-hover"
												id="model-viewdetials">
												<thead>
													<tr>
														<th style="text-align: center; vertical-align: top"
															scope="col">Owners</th>
														<th style="text-align: center; vertical-align: top"
															scope="col">Available spaces</th>
														<th style="text-align: center; vertical-align: top"
															scope="col">Disabled spaces</th>
													</tr>
												</thead>
												<tbody>
													<tr style="text-align: center; vertical-align: top">

														<td th:text="${carpark.users.toString()}"></td>
														<td th:text="${carpark.carParkSpots.size()}"></td>
														<td th:text="${carpark.getDisabledSpots().size()}"></td>
													</tr>
												</tbody>


											</table>
										</div>
										<br>
										<div class="card">
											<table class="table table-striped table-hover">

												<thead>
													<tr>
														<th style="text-align: center; vertical-align: top"
															scope="col">Day</th>
														<th style="text-align: center; vertical-align: top"
															scope="col">Opening time</th>
														<th style="text-align: center; vertical-align: top"
															scope="col">Closing time</th>
													</tr>
												</thead>
												<tbody>
													<tr style="text-align: center; vertical-align: top"
														th:each="carparktime : ${carpark.orderTimes()}">

														<td th:text="${carparktime.dayOfWeek}"></td>
														<td
															th:text="(${carparktime.openTime} == null ? 'Closed' : (${carparktime.openTime} == '00:00' ? 'All day' : ${carparktime.openTime}))"></td>
														<td
															th:text="(${carparktime.closeTime} == null ? 'Closed' : (${carparktime.openTime} == '00:00' ? 'All day' : ${carparktime.closeTime}))"></td>
													</tr>
												</tbody>
											</table>
										</div>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-secondary"
											data-dismiss="modal">Close</button>
									</div>
								</div>
							</div>
						</div>


						<div class="modal" role="dialog"
							th:attr="id='viewcomments'+ ${carpark}">
							<div class="modal-dialog" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title">View car park comments</h5>
										<button type="button" class="close" data-dismiss="modal"
											aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<form id="addcommentform" method="post" th:action="'/viewcarpark/addcomment/' + ${carpark.carParkId}"
										th:object="${carParkDto}">
										<div class="modal-body">
											<div class="card">
												<table class="table" style="table-layout: fixed;word-wrap: break-word;"
													id="model-viewcomments">
													<thead>
														<tr>
															
															<th style="text-align: left; vertical-align: top"
																scope="col">Comment</th>
															<th style="text-align: center; vertical-align: top; width: 20%;"
																scope="col"></th>
														</tr>
													</thead>
													<tbody>
														<tr th:each="carparkcomment : ${carpark.carParkComments}">
															
															<td style="text-align: left;" th:text="${carparkcomment.users}+': '+${carparkcomment.comment}"></td>
															<td th:text="${#dates.format(carparkcomment.dateCreated, 'dd/MM/yy HH:mm')}"></td>
														</tr>
													</tbody>
												</table>
											</div>
											<br>
											<textarea class="form-control" id="comment" type="textarea"
												th:field="*{comment}" required autofocus="autofocus"></textarea>

										</div>

										<div class="modal-footer">
											<button class="btn btn-primary" id="addcomment"
												type="submit">Add comment</button>
											<button type="button" class="btn btn-secondary"
												data-dismiss="modal">Close</button>
										</div>
									</form>
								</div>
							</div>
						</div>
					</td>


				</tr>

			</tbody>
		</table>
	</div>


	<br>
	<br>
	<br>
	<script th:inline="javascript">
/* 		$(document).ready(
				function() {

					$("#addcomment").click(
							function() {
								//console.log($(this).attr("value"));
								$.ajax({
									type : "POST",
									url : "viewcarpark/addcomment/"+$(this).attr("value"),
									success : function(result) {

										$("#addcommentform").attr("th:object",
												result.carParkComments);
									}
								});
							});

				}); */
	</script>
</body>
</html>